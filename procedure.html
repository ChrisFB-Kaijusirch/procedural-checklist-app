<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Procedural Checklist System</title>
  <link rel="icon" href="data:,">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 2rem;
      background-color: #f5f7fa;
      color: #2d3748;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .header-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    .checklist-controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .task-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .task-card {
      padding: 1.5rem;
      background: #f8fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .task-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    .add-task-section {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #f0f4f8;
      border-radius: 8px;
    }
    /* ... (remaining CSS styles remain similar to previous version) ... */
  </style>
</head>
<body>
  <div class="container">
    <h1>Procedural Checklist System</h1>
    
    <!-- Header Section -->
    <div class="header-section">
      <div>
        <label><strong>Agent Name:</strong></label>
        <input type="text" id="agent-name" class="full-width-input" placeholder="Enter agent name">
      </div>
      <div class="date-picker">
        <label><strong>Select Date:</strong></label>
        <input type="date" id="selected-date" class="full-width-input" required>
      </div>
    </div>

    <!-- Checklist Section -->
    <div class="task-section" id="task-list">
      <!-- Dynamic tasks will be inserted here -->
    </div>

    <!-- Add Custom Task Section -->
    <div class="add-task-section">
      <h3>Add Custom Task</h3>
      <div class="task-controls">
        <input type="time" id="new-task-time" class="time-input">
        <input type="text" id="new-task-desc" class="task-desc-input" placeholder="Task description">
        <button onclick="addCustomTask()" class="add-task-btn">Add Task</button>
      </div>
    </div>

    <!-- Messages Section -->
    <div class="messages-section">
      <label><strong>Messages for Next Shift:</strong></label>
      <textarea id="next-shift-messages"></textarea>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="new-btn" onclick="newChecklist()">New Checklist</button>
      <button class="save-btn" onclick="saveChecklist()">Save Checklist</button>
      <button class="history-btn" onclick="viewRecords()">View History</button>
    </div>

    <!-- Records Section -->
    <div class="records-section" id="records-list" style="display: none;">
      <h2>Previous Records</h2>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase Initialization
    const supabaseUrl = 'https://nupndjakdqzubvtvduog.supabase.co';
    const supabaseKey = 'YOUR_SUPABASE_KEY';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // Enhanced Task Data Structure
    const baseTasks = {
      weekday: [
        { time: "00:00", task: "Enter/Check bookings in orange folder", category: "Bookings" },
        { time: "00:00", task: "File completed bookings from all 3 account folders", category: "Bookings" },
        { time: "08:00", task: "Check for duplicate bookings", category: "All Hours" },
        { time: "08:30", task: "Email to council Mon-Fri shift supervisor (Douglas SC)", category: "Douglas SC" },
        { time: "08:45", task: "Email to council Mon-Fri shift supervisor (Cook SC)", category: "Cook SC" }
      ],
      weekend: [
        { time: "00:00", task: "Enter/Check bookings in orange folder", category: "Bookings" },
        { time: "00:00", task: "File completed bookings from all 3 account folders (Sat Only)", category: "Bookings" },
        { time: "08:00", task: "Check for duplicate bookings", category: "All Hours" },
        { time: "08:30", task: "Email to council Sat-Sun shift supervisor (Douglas SC)", category: "Douglas SC" },
        { time: "08:45", task: "Email to council Sat-Sun shift supervisor (Cook SC)", category: "Cook SC" }
      ]
    };

    // Initialize Checklist
    function initializeChecklist() {
      const dateInput = document.getElementById('selected-date');
      const selectedDate = new Date(dateInput.value || Date.now());
      const isWeekend = [0, 6].includes(selectedDate.getDay());
      
      const tasks = isWeekend ? baseTasks.weekend : baseTasks.weekday;
      const taskList = document.getElementById('task-list');
      
      taskList.innerHTML = tasks.map((task, index) => `
        <div class="task-card">
          <div class="task-item">
            <input type="checkbox" id="task-${index}" 
                   data-time="${task.time}" data-category="${task.category}">
            <div>
              <div class="task-time">${task.time} - ${task.category}</div>
              <div class="task-desc">${task.task}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Add Custom Task Functionality
    function addCustomTask() {
      const time = document.getElementById('new-task-time').value;
      const desc = document.getElementById('new-task-desc').value;
      
      if (!time || !desc) {
        alert('Please fill both time and description fields');
        return;
      }

      const taskList = document.getElementById('task-list');
      const taskId = `custom-${Date.now()}`;
      
      taskList.innerHTML += `
        <div class="task-card">
          <div class="task-item">
            <input type="checkbox" id="${taskId}" 
                   data-time="${time}" data-category="Custom Task">
            <div>
              <div class="task-time">${time} - Custom Task</div>
              <div class="task-desc">${desc}</div>
            </div>
            <button onclick="this.parentElement.parentElement.remove()" 
                    class="delete-btn">×</button>
          </div>
        </div>
      `;

      // Clear input fields
      document.getElementById('new-task-time').value = '';
      document.getElementById('new-task-desc').value = '';
    }

    // Enhanced Save Function
    async function saveChecklist() {
      const tasks = Array.from(document.querySelectorAll('.task-card input[type="checkbox"]'))
        .map(checkbox => ({
          time: checkbox.dataset.time,
          category: checkbox.dataset.category,
          task: checkbox.parentElement.querySelector('.task-desc').textContent,
          completed: checkbox.checked
        }));

      const checklistData = {
        agent_name: document.getElementById('agent-name').value,
        date: document.getElementById('selected-date').value,
        messages: document.getElementById('next-shift-messages').value,
        tasks: tasks
      };

      const { error } = await supabase
        .from('checklists')
        .insert([checklistData]);

      error ? alert('Error saving checklist!') : alert('Checklist saved successfully!');
    }

    // Enhanced Load Function
    async function loadChecklist() {
      const { data, error } = await supabase
        .from('checklists')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(1);

      if (!error && data.length > 0) {
        const record = data[0];
        // Load record data
        document.getElementById('agent-name').value = record.agent_name;
        document.getElementById('selected-date').value = record.date;
        document.getElementById('next-shift-messages').value = record.messages;
        
        // Rebuild task list
        const taskList = document.getElementById('task-list');
        taskList.innerHTML = record.tasks.map((task, index) => `
          <div class="task-card">
            <div class="task-item">
              <input type="checkbox" id="task-${index}" 
                     ${task.completed ? 'checked' : ''}
                     data-time="${task.time}" data-category="${task.category}">
              <div>
                <div class="task-time">${task.time} - ${task.category}</div>
                <div class="task-desc">${task.task}</div>
              </div>
              ${task.category === 'Custom Task' ? 
                '<button onclick="this.parentElement.parentElement.remove()" class="delete-btn">×</button>' : ''}
            </div>
          </div>
        `).join('');
      }
    }

    // Initial Setup
    document.getElementById('selected-date').value = new Date().toISOString().split('T')[0];
    document.getElementById('selected-date').addEventListener('change', initializeChecklist);
    initializeChecklist();
  </script>
</body>
</html>
